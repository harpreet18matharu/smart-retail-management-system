<%- include("partials/header", { active: "products", title: "Inventory Management" }) %>

<div class="container mt-4">
  <h1><%= title %></h1>

  <div class="mb-3 d-flex justify-content-between align-items-center">
    <a href="/products/create" class="btn btn-primary">+ Add New Product</a>

    <form method="GET" action="/products" class="d-flex align-items-center">
      
      <div class="me-2">
        <label for="category" class="form-label mb-0 me-1">Category:</label>
        <select name="category" id="category" class="form-select form-select-sm">
          <option value="all" <%= selectedCategory === "all" ? "selected" : "" %>>
            All
          </option>
          <% if (categories) { %>
            <% categories.forEach(function(cat) { %>
              <option value="<%= cat %>"
                <%= selectedCategory === cat ? "selected" : "" %>>
                <%= cat %>
              </option>
            <% }) %>
          <% } %>
        </select>
      </div>

      <div class="me-2">
        <label for="sort" class="form-label mb-0 me-1">Sort by:</label>
        <select name="sort" id="sort" class="form-select form-select-sm">
          <option value="newest" <%= selectedSort === "newest" ? "selected" : "" %>>
            Newest
          </option>
          <option value="priceAsc" <%= selectedSort === "priceAsc" ? "selected" : "" %>>
            Price: Low to High
          </option>
          <option value="priceDesc" <%= selectedSort === "priceDesc" ? "selected" : "" %>>
            Price: High to Low
          </option>
          <option value="nameAsc" <%= selectedSort === "nameAsc" ? "selected" : "" %>>
            Name: A → Z
          </option>
          <option value="nameDesc" <%= selectedSort === "nameDesc" ? "selected" : "" %>>
            Name: Z → A
          </option>
        </select>
      </div>

      <div class="me-3 form-check d-flex align-items-center mb-0">
        <input class="form-check-input me-2" type="checkbox" 
               name="outOfStock" 
               id="outOfStock" 
               <%= (typeof query !== 'undefined' && query.outOfStock === 'on') ? 'checked' : '' %>>
        <label class="form-check-label text-nowrap" for="outOfStock">
          Show Out of Stock Only
        </label>
      </div>

      <button type="submit" class="btn btn-sm btn-outline-secondary">
        Apply
      </button>
    </form>
  </div>

  <% if (products && products.length > 0) { %>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Product ID</th>
          <th>Name</th>
          <th>Category</th>
          <th>Brand</th>
          <th>Price</th>
          <th>In Stock?</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
      <% products.forEach(function(p) { %>
        <tr>
          <td><%= p.product_id %></td>
          <td><%= p.product_name %></td>
          <td><%= p.category %></td>
          <td><%= p.brand %></td>
          <td>$<%= p.price %></td>
          <td class="<%= p.is_in_stock ? 'text-success' : 'text-danger fw-bold' %>">
            <%= p.is_in_stock ? "Yes" : "No" %>
          </td>
          <td>
            <a href="/products/<%= p._id %>" class="btn btn-sm btn-info">View</a>
            <a href="/products/<%= p._id %>/edit" class="btn btn-sm btn-warning">Edit</a>

            <form action="/products/<%= p._id %>?_method=DELETE" method="POST" style="display:inline-block">
              <button type="submit" class="btn btn-sm btn-danger"
                      onclick="return confirm('Delete this product?');">
                Delete
              </button>
            </form>
          </td>
        </tr>
      <% }) %>
      </tbody>
    </table>
  <% } else { %>
    <p>No products found. <a href="/products/create">Add one now</a>.</p>
  <% } %>
</div>

<%- include("partials/footer") %>